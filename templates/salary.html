{% extends "base.html" %}

{% block title %}2025 ì „ë¬¸ ê¸‰ì—¬ ê³„ì‚°ê¸°{% endblock %}

{% block content %}
    <h2>ğŸ’° ì „ë¬¸ ê¸‰ì—¬ ê³„ì‚°ê¸°</h2>
    <p>ì§ì¥ì¸ ì—°ë´‰ë¶€í„° ì•Œë°”ë¹„(ì£¼íœ´ìˆ˜ë‹¹ í¬í•¨)ê¹Œì§€ í•œ ë²ˆì— ê³„ì‚°í•˜ì„¸ìš”.</p>
    
    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
        
        <form action="/salary/calc" method="post">
            
            <div style="margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
                <label style="margin-right: 20px; font-weight: bold; cursor: pointer;">
                    <input type="radio" name="calc_type" value="salary" checked onclick="toggleOptions('salary')"> ğŸ¢ ì§ì¥ì¸
                </label>
                <label style="margin-right: 20px; font-weight: bold; cursor: pointer;">
                    <input type="radio" name="calc_type" value="hourly" onclick="toggleOptions('hourly')"> â±ï¸ ì•Œë°”(ì‹œê¸‰)
                </label>
                <label style="font-weight: bold; cursor: pointer;">
                    <input type="radio" name="calc_type" value="freelancer" onclick="toggleOptions('freelancer')"> ğŸ’¼ í”„ë¦¬ëœì„œ
                </label>
            </div>

            <div id="salary-input-group">
                <div id="salary-options" class="input-grid">
                    <div>
                        <span class="form-label">ê¸‰ì—¬ ê¸°ì¤€</span>
                        <div class="toggle-group">
                            <input type="radio" id="st_year" name="salary_type" value="year" checked>
                            <label for="st_year">ì—°ë´‰</label>
                            <input type="radio" id="st_month" name="salary_type" value="month">
                            <label for="st_month">ì›”ê¸‰</label>
                        </div>
                    </div>
                    <div>
                        <span class="form-label">í‡´ì§ê¸ˆ</span>
                        <div class="toggle-group">
                            <input type="radio" id="sev_sep" name="severance_type" value="separate" checked>
                            <label for="sev_sep">ë³„ë„</label>
                            <input type="radio" id="sev_inc" name="severance_type" value="included">
                            <label for="sev_inc">í¬í•¨</label>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 5px;">
                    <span class="form-label">ê¸ˆì•¡ ì…ë ¥ (ì›)</span>
                    <input type="number" name="amount" placeholder="ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”" 
                           style="width: 100%; padding: 12px; font-size: 1.1rem; border: 1px solid #ddd; border-radius: 5px;"
                           onkeyup="convertMoney(this, 'salary-preview', 1)">
                </div>
                <div id="salary-preview" class="korean-preview">0ì›</div>
            </div>

            <div id="hourly-options" style="display: none;">
                
                <div style="margin-bottom: 20px;">
                    <span class="form-label">ì‹œê¸‰ (2025 ìµœì €: 10,030ì›)</span>
                    <input type="number" name="hourly_wage" placeholder="10030" 
                           style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;"
                           onkeyup="convertMoney(this, 'hourly-preview', 1)">
                    <div id="hourly-preview" class="korean-preview">0ì›</div>
                </div>

                <div class="input-grid">
                    <div>
                        <span class="form-label">ì¼ì¼ ê·¼ë¬´ì‹œê°„</span>
                        <select name="daily_hours" class="wide-select">
                            {% for i in range(1, 13) %}
                            <option value="{{ i }}" {% if i==8 %}selected{% endif %}>{{ i }}ì‹œê°„</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <span class="form-label">ì¼ì£¼ ê·¼ë¬´ì¼ìˆ˜</span>
                        <select name="weekly_days" class="wide-select">
                            {% for i in range(1, 8) %}
                            <option value="{{ i }}" {% if i==5 %}selected{% endif %}>{{ i }}ì¼</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <span class="form-label">ì›” ì—°ì¥ ê·¼ë¬´ ì‹œê°„ (ì„ íƒ)</span>
                    <select name="overtime_hours" class="wide-select">
                        <option value="0">ì—†ìŒ</option>
                        {% for i in range(1, 51) %}
                        <option value="{{ i }}">{{ i }}ì‹œê°„</option>
                        {% endfor %}
                    </select>
                </div>

                <div style="margin-bottom: 20px;">
                    <span class="form-label">ì£¼íœ´ìˆ˜ë‹¹ â“</span>
                    <div class="toggle-radio-group">
                        <input type="radio" id="juhyu_no" name="juhyu_state" value="excluded" checked>
                        <label for="juhyu_no">ë¯¸í¬í•¨</label>
                        
                        <input type="radio" id="juhyu_yes" name="juhyu_state" value="included">
                        <label for="juhyu_yes">í¬í•¨</label>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <span class="form-label">ì„¸ê¸ˆ</span>
                    <select name="tax_type" class="wide-select">
                        <option value="none">ë¯¸ì ìš© (0%)</option>
                        <option value="3.3">3.3% ê³µì œ</option>
                        <option value="4major">4ëŒ€ë³´í—˜ ì ìš©</option>
                    </select>
                </div>

                <div style="margin-bottom: 20px;">
                    <span class="form-label">ìˆ˜ìŠµê¸°ê°„ (3ê°œì›” ì´ë‚´ 90%) â“</span>
                    <div class="toggle-radio-group">
                        <input type="radio" id="prob_no" name="probation" value="no" checked>
                        <label for="prob_no">ë¯¸ì ìš©</label>
                        
                        <input type="radio" id="prob_yes" name="probation" value="yes">
                        <label for="prob_yes">ì ìš©</label>
                    </div>
                </div>
            </div>


            <div id="advanced-options">
                <hr style="margin: 20px 0; border: 0; border-top: 1px dashed #ddd;">
                <div class="input-grid">
                    <div>
                        <span class="form-label">ë¶€ì–‘ ê°€ì¡± ìˆ˜</span>
                        <div class="counter-box">
                            <button type="button" class="counter-btn" onclick="changeVal('dependents', -1)">-</button>
                            <input type="number" id="dependents" name="dependents" class="counter-input" value="1" readonly>
                            <button type="button" class="counter-btn" onclick="changeVal('dependents', 1)">+</button>
                        </div>
                    </div>
                    <div>
                        <span class="form-label">20ì„¸ ì´í•˜ ìë…€ìˆ˜</span>
                        <div class="counter-box">
                            <button type="button" class="counter-btn" onclick="changeVal('children', -1)">-</button>
                            <input type="number" id="children" name="children" class="counter-input" value="0" readonly>
                            <button type="button" class="counter-btn" onclick="changeVal('children', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <span class="form-label">ë¹„ê³¼ì„¸ì•¡ (ì‹ëŒ€ ë“±)</span>
                    <input type="number" name="non_taxable" value="200000" style="width: 100%; padding: 10px;">
                </div>
            </div>

            <button type="submit" class="btn-yellow">ê³„ì‚°í•˜ê¸°</button>
        </form>
    </div>

    {% if result is not none %}
        <div class="result-box" style="margin-top: 30px; background: #fff; border: 2px solid #555; border-radius: 15px; overflow: hidden;">
            <div style="background-color: #555; color: white; padding: 25px; text-align: center;">
                <p style="margin: 0; font-size: 0.95rem; opacity: 0.9;">ì›” ì˜ˆìƒ ì‹¤ìˆ˜ë ¹ì•¡</p>
                <h2 style="margin: 5px 0 0 0; font-size: 2.2rem; color: #fff;">{{ "{:,}".format(result) }}ì›</h2>
            </div>
            
            <div style="padding: 25px;">
                {% if calc_type == 'hourly' %}
                    <h4 style="border-bottom: 1px solid #eee; padding-bottom: 10px;">ê·¼ë¬´ ìƒì„¸</h4>
                    <div style="font-size: 0.95rem; color: #555; margin-bottom: 20px;">
                        <p>ê¸°ë³¸ê¸‰: {{ "{:,}".format(monthly_salary - overtime_pay - holiday_pay) }}ì› (ì‹œê¸‰ {{ "{:,}".format(base_hourly_rate) }}ì›)</p>
                        <p>ì£¼íœ´ìˆ˜ë‹¹: +{{ "{:,}".format(holiday_pay) }}ì›</p>
                        <p>ì—°ì¥ìˆ˜ë‹¹: +{{ "{:,}".format(overtime_pay) }}ì›</p>
                        <p style="font-weight: bold; color: blue;">ì„¸ì „ ì›”ê¸‰ í•©ê³„: {{ "{:,}".format(monthly_salary) }}ì›</p>
                    </div>
                {% endif %}

                <h4 style="border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px;">ê³µì œ ë‚´ì—­</h4>
                
                <div style="font-size: 1rem;">
                    {% if pension > 0 %}<div style="display: flex; justify-content: space-between; margin-bottom: 10px;"><span>êµ­ë¯¼ì—°ê¸ˆ</span> <span>{{ "{:,}".format(pension) }}ì›</span></div>{% endif %}
                    {% if health > 0 %}<div style="display: flex; justify-content: space-between; margin-bottom: 10px;"><span>ê±´ê°•ë³´í—˜</span> <span>{{ "{:,}".format(health) }}ì›</span></div>{% endif %}
                    {% if care > 0 %}<div style="display: flex; justify-content: space-between; margin-bottom: 10px;"><span>ì¥ê¸°ìš”ì–‘</span> <span>{{ "{:,}".format(care) }}ì›</span></div>{% endif %}
                    {% if employ > 0 %}<div style="display: flex; justify-content: space-between; margin-bottom: 10px;"><span>ê³ ìš©ë³´í—˜</span> <span>{{ "{:,}".format(employ) }}ì›</span></div>{% endif %}
                    
                    {% if income_tax > 0 or local_tax > 0 %}
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;"><span>ì†Œë“ì„¸</span> <span>{{ "{:,}".format(income_tax) }}ì›</span></div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;"><span>ì§€ë°©ì†Œë“ì„¸</span> <span>{{ "{:,}".format(local_tax) }}ì›</span></div>
                    {% endif %}
                    
                    {% if total_tax == 0 %}
                    <div style="text-align: center; color: #999; margin: 20px 0;">ê³µì œëœ ì„¸ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>
                    {% endif %}
                </div>

                <hr style="margin: 20px 0; border: 0; border-top: 2px dashed #eee;">
                <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem;">
                    <span style="color: #333;">ê³µì œì•¡ í•©ê³„</span>
                    <span style="color: #ff4d4d;">- {{ "{:,}".format(total_tax) }}ì›</span>
                </div>
            </div>
        </div>
    {% endif %}

    <script>
        function toggleOptions(type) {
            const salaryInputGroup = document.getElementById('salary-input-group'); // ì§ì¥ì¸ ê¸ˆì•¡ì…ë ¥ì°½
            const hourlyOptions = document.getElementById('hourly-options');       // ì•Œë°” ìƒì„¸ì˜µì…˜
            const salaryOptions = document.getElementById('salary-options');       // ì—°ë´‰/ì›”ê¸‰ ì„ íƒ
            const advOptions = document.getElementById('advanced-options');        // ê³ ê¸‰ì„¤ì • (ë¶€ì–‘ê°€ì¡± ë“±)

            if (type === 'hourly') {
                // ì•Œë°” ì„ íƒ ì‹œ
                salaryInputGroup.style.display = 'none'; // ê¸°ë³¸ ê¸ˆì•¡ ì…ë ¥ì°½ ìˆ¨ê¹€
                hourlyOptions.style.display = 'block';   // ì•Œë°” ìƒì„¸í¼ ë³´ì„
                advOptions.style.display = 'none';       // [ë³€ê²½] ë¶€ì–‘ê°€ì¡±/ë¹„ê³¼ì„¸ ìˆ¨ê¹€
            } else if (type === 'freelancer') {
                // í”„ë¦¬ëœì„œ
                salaryInputGroup.style.display = 'block';
                hourlyOptions.style.display = 'none';
                salaryOptions.style.display = 'none';
                advOptions.style.display = 'none';       // í”„ë¦¬ëœì„œë„ ìˆ¨ê¹€
            } else {
                // ì§ì¥ì¸ (ê¸°ë³¸)
                salaryInputGroup.style.display = 'block';
                hourlyOptions.style.display = 'none';
                salaryOptions.style.display = 'grid';
                advOptions.style.display = 'block';      // ì§ì¥ì¸ë§Œ ê³ ê¸‰ì„¤ì • ë³´ì„
            }
        }
        
        function changeVal(id, delta) {
            const input = document.getElementById(id);
            let val = parseInt(input.value) || 0;
            val += delta;
            if (val < 0) val = 0;
            input.value = val;
        }

        function convertMoney(input, targetId, unitMultiplier) {
            const val = input.value;
            const target = document.getElementById(targetId);
            if (!val || val == 0) { target.innerText = "0ì›"; return; }
            const numberVal = parseInt(val) * unitMultiplier;
            const unitWords = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
            let result = '';
            let num = numberVal;
            let count = 0;
            while (num > 0) {
                let mod = num % 10000;
                if (mod > 0) {
                    result = formatNumber(mod) + unitWords[count] + ' ' + result;
                }
                num = Math.floor(num / 10000);
                count++;
            }
            target.innerText = result + "ì›";
        }
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
    </script>
{% endblock %}