{% extends "base.html" %}

{% block content %}
<style>
    /* 1. ì „ì²´ ë ˆì´ì•„ì›ƒ & ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .calc-container { max-width: 100%; box-sizing: border-box; }
    
    .section-box {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        word-break: keep-all; 
    }

    .form-label {
        font-weight: bold;
        color: #555;
        display: block;
        margin-bottom: 8px;
        font-size: 0.95rem;
    }

    /* 2. ì…ë ¥ì°½ ë””ìì¸ */
    input[type="text"], input[type="number"], select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        box-sizing: border-box;
        text-align: right; /* ìˆ«ì ìš°ì¸¡ ì •ë ¬ */
        font-family: 'Pretendard', sans-serif;
    }

    input:focus, select:focus {
        border-color: #007bff;
        outline: none;
    }

    /* ë¹„í™œì„±í™”(Disabled) ìŠ¤íƒ€ì¼ */
    input:disabled {
        background-color: #e9ecef !important;
        color: #adb5bd !important;
        border-color: #ced4da !important;
        cursor: not-allowed;
    }

    /* í•œê¸€ ê¸ˆì•¡ í‘œì‹œ (ìš°ì¸¡ í•˜ë‹¨) */
    .unit-text {
        text-align: right;
        font-size: 0.85rem;
        color: #007bff;
        margin-top: 4px;
        font-weight: bold;
        min-height: 1.2em;
    }

    /* 3. ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œ */
    .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media (max-width: 768px) { .input-grid { grid-template-columns: 1fr; } }

    /* 4. ê²°ê³¼ ë°•ìŠ¤ ë””ìì¸ */
    .result-box {
        margin-top: 30px;
        border-radius: 15px;
        overflow: hidden;
        background: white;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border: 2px solid #eee;
    }
    .result-header { padding: 20px; text-align: center; color: white; }
    .result-body { display: flex; position: relative; }
    .result-col { flex: 1; padding: 25px 20px; display: flex; flex-direction: column; align-items: center; }
    .result-divider { width: 1px; background-color: #eee; margin: 20px 0; }
    .winner-bg { background-color: #f0f7ff; }

    /* 5. ë¶„ì„ íŒ ë°•ìŠ¤ */
    .tip-box {
        margin-top: 15px;
        background-color: #fff3cd;
        border: 1px solid #ffeeba;
        color: #856404;
        padding: 15px;
        border-radius: 8px;
        font-size: 0.95rem;
        line-height: 1.6;
    }
    .tip-highlight {
        font-weight: bold;
        color: #d32f2f;
        background: rgba(255,255,255,0.5);
        padding: 0 5px;
        border-radius: 4px;
    }
    
    /* 6. ë¬¸ì˜í•˜ê¸° ì„¹ì…˜ ìŠ¤íƒ€ì¼ (ë²„íŠ¼í˜•) */
    .contact-section {
        margin-top: 80px;
        padding: 40px 20px;
        border-top: 4px dotted #ddd;
        text-align: center;
        background-color: #f9f9f9;
        border-radius: 15px;
    }
    
    .btn-contact {
        display: inline-block;
        background-color: #333;
        color: white;
        padding: 15px 30px;
        border-radius: 30px;
        text-decoration: none;
        font-size: 1.1rem;
        font-weight: bold;
        transition: background-color 0.2s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .btn-contact:hover {
        background-color: #555;
        transform: translateY(-2px);
    }
</style>

<div class="calc-container">
    <div style="text-align: center; margin-bottom: 30px;">
        <h2 style="font-size: 1.8rem; color: #333; margin-bottom: 10px;">ğŸ“‰ ìê¸‰ì œ vs ì„±ì§€ ê°€ê²© ë¹„êµ</h2>
        <p style="color: #666;">ì´ˆê¸° 6ê°œì›” ìš”ê¸ˆì œ ìœ ì§€ ì¡°ê±´ê¹Œì§€ <span style="color: #d32f2f; font-weight: bold;">ì™„ë²½ ë°˜ì˜!</span></p>
    </div>

    <div class="section-box">
        <form action="/calc" method="post" id="calcForm" onsubmit="return prepareSubmit()">
            
            <div style="margin-bottom: 30px; background-color: #f8f9fa; padding: 20px; border-radius: 10px; border: 1px solid #e9ecef;">
                <div style="margin-bottom: 15px;">
                    <span class="form-label">ğŸ“± ë¹„êµí•  ê¸°ê¸° ì„ íƒ</span>
                    <select name="phone_code" id="phone_select" onchange="updatePrice()" style="text-align: left;">
                        {% for code, info in phones.items() %}
                        <option value="{{ code }}" data-price="{{ info.price }}" {% if selected_code == code %}selected{% endif %}>
                            {{ info.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <span class="form-label">ğŸ’° ê¸°ê¸°ê°’ (ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥)</span>
                    <input type="text" inputmode="numeric" name="device_price" id="device_price" 
                           value="{{ input_price|default(0) }}" 
                           onkeyup="formatNumber(this)" 
                           style="border: 2px solid #007bff; font-weight: bold;">
                    <div id="unit_device_price" class="unit-text"></div>
                </div>
            </div>

            <div class="input-grid">
                <div style="background-color: #fff; padding: 20px; border-radius: 10px; border: 1px solid #ddd;">
                    <h3 style="text-align: center; color: #333; margin-bottom: 20px; font-size: 1.2rem;">ğŸª™ ìê¸‰ì œ + ì•Œëœ°í°</h3>
                    <div style="margin-bottom: 15px;">
                        <span class="form-label">ì•Œëœ°í° ìš”ê¸ˆì œ (ì›”)</span>
                        <input type="text" inputmode="numeric" name="mvno_cost" id="mvno_cost"
                               placeholder="33,000" value="{{ input_mvno|default(33000) }}" 
                               onkeyup="formatNumber(this)">
                        <div id="unit_mvno_cost" class="unit-text"></div>
                    </div>
                </div>

                <div style="background-color: #e3f2fd; padding: 20px; border-radius: 10px; border: 1px solid #90caf9;">
                    <h3 style="text-align: center; color: #0d47a1; margin-bottom: 20px; font-size: 1.2rem;">ğŸ¢ í†µì‹ ì‚¬ ì•½ì •</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <span class="form-label">í• ì¸ ë°©ì‹ ì„ íƒ</span>
                        <div style="display: flex; gap: 10px; background: white; padding: 10px; border-radius: 8px;">
                            <label style="cursor: pointer; flex: 1; display: flex; align-items: center; justify-content: center; gap: 5px;">
                                <input type="radio" name="carrier_type" value="gongsi" onclick="checkSubsidyStatus()" 
                                {% if carrier_type == 'gongsi' or carrier_type is not defined %}checked{% endif %}> 
                                <span>ê³µì‹œì§€ì›ê¸ˆ</span>
                            </label>
                            <label style="cursor: pointer; flex: 1; display: flex; align-items: center; justify-content: center; gap: 5px;">
                                <input type="radio" name="carrier_type" value="seonyak" onclick="checkSubsidyStatus()" 
                                {% if carrier_type == 'seonyak' %}checked{% endif %}> 
                                <span>ì„ íƒì•½ì •</span>
                            </label>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; border: 1px dashed #0d47a1; padding: 15px; border-radius: 8px; background: #f0f7ff;">
                        <div style="margin-bottom: 10px;">
                            <span class="form-label" style="font-size:0.9em;">â‘  ì´ˆê¸° ìš”ê¸ˆì œ & ìœ ì§€ê¸°ê°„</span>
                            <div style="display: flex; gap: 5px;">
                                <div style="flex: 2;">
                                    <input type="text" inputmode="numeric" name="plan_cost" id="plan_cost"
                                           placeholder="ì˜ˆ: 100,000" value="{{ input_plan|default(90000) }}"
                                           onkeyup="formatNumber(this)">
                                    <div id="unit_plan_cost" class="unit-text"></div>
                                </div>
                                <div style="flex: 1; position: relative;">
                                    <input type="number" name="plan_period" value="{{ input_plan_period|default(6) }}" style="text-align: center;">
                                    <span style="position: absolute; right: 5px; top: 12px; font-size: 0.8em; color: #888; pointer-events: none;">ê°œì›”</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span class="form-label" style="font-size:0.9em;">â‘¡ ì´í›„ ë³€ê²½ ìš”ê¸ˆì œ</span>
                            <input type="text" inputmode="numeric" name="plan_cost_after" id="plan_cost_after"
                                   placeholder="ì˜ˆ: 69,000" value="{{ input_plan_after|default('') }}"
                                   onkeyup="formatNumber(this)">
                            <div id="unit_plan_cost_after" class="unit-text"></div>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <span class="form-label">ê³µì‹œì§€ì›ê¸ˆ (ê¸°ê¸°ê°’ í• ì¸)</span>
                        <input type="text" inputmode="numeric" id="subsidy_input" name="subsidy" 
                               placeholder="500,000" value="{{ input_subsidy|default(500000) }}"
                               onkeyup="formatNumber(this)">
                        <div id="unit_subsidy_input" class="unit-text"></div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <span class="form-label" style="color: #d32f2f;">ğŸ’¸ ëŒ€ë¦¬ì  ì§€ì›ê¸ˆ</span>
                        <input type="text" inputmode="numeric" name="store_subsidy" id="store_subsidy"
                               placeholder="ì˜ˆ: 300,000" value="{{ input_store_subsidy|default(0) }}" 
                               style="border: 2px solid #ffcdd2; background-color: #fff5f5;"
                               onkeyup="formatNumber(this)">
                        <div id="unit_store_subsidy" class="unit-text"></div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <span class="form-label" style="color: #007bff;">â• ë¶€ê°€ì„œë¹„ìŠ¤ (ê¸ˆì•¡ / ê°œì›”)</span>
                        <div style="display: flex; gap: 5px;">
                            <div style="flex: 2;">
                                <input type="text" inputmode="numeric" name="addon_cost" id="addon_cost"
                                       placeholder="ê¸ˆì•¡" value="{{ input_addon_cost|default('') }}" 
                                       style="border: 1px solid #90caf9;"
                                       onkeyup="formatNumber(this)">
                                <div id="unit_addon_cost" class="unit-text"></div>
                            </div>
                            <div style="flex: 1;">
                                <input type="number" name="addon_months" placeholder="3" value="{{ input_addon_months|default(3) }}" 
                                       style="border: 1px solid #90caf9; text-align: center;">
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <span class="form-label">ì¶”ê°€ ì›” í• ì¸ (ê²°í•© ë“±)</span>
                        
                        <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                            <label style="cursor: pointer; font-size: 0.9em;">
                                <input type="radio" name="add_discount_type" value="amount" onclick="toggleDiscountType('amount')" 
                                {% if input_add_discount_type == 'amount' or input_add_discount_type is not defined %}checked{% endif %}> 
                                ê¸ˆì•¡(ì›) í• ì¸
                            </label>
                            <label style="cursor: pointer; font-size: 0.9em;">
                                <input type="radio" name="add_discount_type" value="rate" onclick="toggleDiscountType('rate')"
                                {% if input_add_discount_type == 'rate' %}checked{% endif %}> 
                                ë¹„ìœ¨(%) í• ì¸
                            </label>
                        </div>
                        
                        <input type="text" inputmode="numeric" name="add_discount" id="add_discount"
                               placeholder="ì˜ˆ: 5,000" 
                               value="{{ input_add_discount|default(0) }}"
                               onkeyup="formatDiscountInput(this)">
                        
                        <div id="unit_add_discount" class="unit-text"></div>
                    </div>
                    </div>
            </div>
            
            <button type="submit" class="btn-yellow">ğŸ’° ìµœì €ê°€ ë¹„êµí•˜ê¸°</button>
        </form>
    </div>

    {% if result %}
    <div class="result-box" style="border-color: {% if winner == 'self' %}#333{% else %}#0d47a1{% endif %};">
        <div class="result-header" style="background-color: {% if winner == 'self' %}#333{% else %}#0d47a1{% endif %};">
            <h2 style="margin: 0; font-size: 1.6rem;">ğŸ† {{ recommend_text }}</h2>
            <p style="margin-top: 5px; opacity: 0.9;">2ë…„ê°„ ì´ <span style="font-weight: bold; color: #ffeb3b;">{{ "{:,}".format(diff_price) }}ì›</span> ì ˆì•½!</p>
        </div>
        
        <div class="result-body">
            <div class="result-col {% if winner == 'self' %}winner-bg{% endif %}">
                <h3 style="color: #333; margin-bottom: 10px;">ìê¸‰ì œ</h3>
                <div style="text-align: center;">
                    <p style="font-size: 0.9rem; color: #666;">2ë…„ ì´ ë¹„ìš©</p>
                    <p style="font-size: 1.6rem; font-weight: bold; color: #333; margin: 5px 0;">{{ "{:,}".format(self_total) }}ì›</p>
                </div>
                <div style="margin-top: 15px; width: 100%; font-size: 0.85rem; color: #555; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px;">
                    <p>â€¢ ê¸°ê¸°ê°’: {{ "{:,}".format(input_price) }}ì›</p>
                    <p>â€¢ ì•Œëœ°í°: {{ "{:,}".format(input_mvno * 24) }}ì›</p>
                </div>
            </div>

            <div class="result-divider"></div>

            <div class="result-col {% if winner == 'carrier' %}winner-bg{% endif %}">
                <h3 style="color: #0d47a1; margin-bottom: 10px;">í†µì‹ ì‚¬</h3>
                <div style="text-align: center;">
                    <p style="font-size: 0.9rem; color: #666;">2ë…„ ì´ ë¹„ìš©</p>
                    <p style="font-size: 1.6rem; font-weight: bold; color: #0d47a1; margin: 5px 0;">{{ "{:,}".format(carrier_total) }}ì›</p>
                </div>
                <div style="margin-top: 15px; width: 100%; font-size: 0.85rem; color: #555; background: rgba(13, 71, 161, 0.05); padding: 10px; border-radius: 8px;">
                    <p style="display: flex; justify-content: space-between;"><span>í• ë¶€ì›ê¸ˆ</span><b>{{ "{:,}".format(carrier_principal) }}ì›</b></p>
                    <p style="display: flex; justify-content: space-between;"><span>ì´ì(5.9%)</span><span>+{{ "{:,}".format(carrier_interest) }}ì›</span></p>
                    <p style="display: flex; justify-content: space-between;"><span>í†µì‹ ë£Œ</span><span>+{{ "{:,}".format(plan_total_cost) }}ì›</span></p>
                    {% if input_addon_cost > 0 %}
                    <p style="display: flex; justify-content: space-between; color: #d32f2f;"><span>ë¶€ê°€ì„œë¹„ìŠ¤</span><span>+{{ "{:,}".format(addon_total_cost) }}ì›</span></p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div style="padding: 0 20px 20px 20px;">
            {% if winner == 'self' %}
            <div class="tip-box">
                <h4 style="margin: 0 0 10px 0; color: #856404;">ğŸ’¡ í†µì‹ ì‚¬ ê°œí†µì´ ì´ë“ì´ ë˜ë ¤ë©´?</h4>
                <p style="margin: 5px 0;">í˜„ì¬ ì¡°ê±´ì—ì„œëŠ” ìê¸‰ì œê°€ ë” ì €ë ´í•©ë‹ˆë‹¤. ì•„ë˜ ì¡°ê±´ì„ í˜‘ìƒí•´ë³´ì„¸ìš”:</p>
                <ul style="margin: 10px 0 0 20px; padding: 0;">
                    <li>
                        ëŒ€ë¦¬ì  ì§€ì›ê¸ˆ(ì§€ì›ê¸ˆ)ì„ <span class="tip-highlight">
                        {{ "{:,}".format(input_store_subsidy + needed_additional_subsidy) }}ì› ì´ìƒ</span> ë°›ì•„ì•¼ ë³¸ì „ì…ë‹ˆë‹¤.
                        <br><span style="font-size: 0.8em; color: #666;">(í˜„ì¬ë³´ë‹¤ ì•½ {{ "{:,}".format(needed_additional_subsidy) }}ì› ë” í•„ìš”)</span>
                    </li>
                    <li style="margin-top: 8px;">
                        ë˜ëŠ”, ì›” ìš”ê¸ˆì œë¥¼ <span class="tip-highlight">
                        {% if target_monthly_plan > 0 %}
                            ì•½ {{ "{:,}".format(target_monthly_plan) }}ì›
                        {% else %}
                            0ì› (í˜„ì‹¤ì  ë¶ˆê°€ëŠ¥)
                        {% endif %}
                        </span> ìˆ˜ì¤€ìœ¼ë¡œ ë‚®ì¶°ì•¼ í•©ë‹ˆë‹¤.
                    </li>
                </ul>
            </div>
            {% else %}
            <div class="tip-box" style="background-color: #d4edda; border-color: #c3e6cb; color: #155724;">
                <h4 style="margin: 0 0 5px 0;">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h4>
                <p style="margin: 0;">í˜„ì¬ ëŒ€ë¦¬ì /ì„±ì§€ ì¡°ê±´ì´ ìê¸‰ì œë³´ë‹¤ <strong>{{ "{:,}".format(diff_price) }}ì›</strong> ì €ë ´í•©ë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <div id="contact" class="contact-section">
        <h2 style="color: #333; margin-bottom: 15px;">ğŸ“© ë¬¸ì˜í•˜ê¸°</h2>
        <p style="color: #666; margin-bottom: 30px; font-size: 1rem;">
            ê´‘ê³  ì œíœ´, ì„œë¹„ìŠ¤ ì˜¤ë¥˜ ì œë³´, ê±´ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹ ê°€ìš”?<br>
            ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ í¸í•˜ê²Œ ë‚¨ê²¨ì£¼ì„¸ìš”.
        </p>
        <a href="https://docs.google.com/forms/d/e/1FAIpQLSd9hUnvAxlpSpKmGf5VwahEwiVvLQn8nBVrF6EtGY8dlbyf6A/viewform?usp=sharing" 
           target="_blank" class="btn-contact">
            ğŸ“ ë¬¸ì˜ ì‘ì„±í•˜ëŸ¬ ê°€ê¸° (êµ¬ê¸€ í¼)
        </a>
    </div>

</div>

<script>
    // 1. ìˆ«ì í¬ë§·íŒ… (ì½¤ë§ˆ + í•œê¸€ ë³€í™˜)
    function formatNumber(input) {
        let rawValue = input.value.replace(/[^0-9]/g, '');
        if(rawValue.length > 1 && rawValue.startsWith('0')) rawValue = rawValue.substring(1);

        if (!rawValue) {
            input.value = '';
            let u = document.getElementById('unit_' + input.id);
            if(u) u.innerText = '';
            return;
        }

        input.value = Number(rawValue).toLocaleString();
        let unitText = convertToKoreanNumber(rawValue);
        let unitDiv = document.getElementById('unit_' + input.id);
        if (unitDiv) unitDiv.innerText = unitText;
    }

    // [New] í• ì¸ ì…ë ¥ì°½ ì „ìš© í¬ë§·íŒ… (ìœ í˜•ì— ë”°ë¼ ë‹¤ë¦„)
    function formatDiscountInput(input) {
        const type = document.querySelector('input[name="add_discount_type"]:checked').value;
        
        if (type === 'rate') {
            // ë¹„ìœ¨(%)ì¸ ê²½ìš°: ì½¤ë§ˆ/í•œê¸€ ì—†ìŒ, 100 ì´ˆê³¼ ë°©ì§€
            let val = input.value.replace(/[^0-9]/g, '');
            if(val > 100) val = '100';
            input.value = val;
            
            // í•œê¸€ ë‹¨ìœ„ ìˆ¨ê¸°ê¸°
            let u = document.getElementById('unit_' + input.id);
            if(u) u.innerText = '';
        } else {
            // ê¸ˆì•¡(ì›)ì¸ ê²½ìš°: ê¸°ì¡´ í¬ë§·íŒ… ì‚¬ìš©
            formatNumber(input);
        }
    }

    // [New] í• ì¸ ìœ í˜• ë³€ê²½ ì‹œ ì…ë ¥ê°’ ì´ˆê¸°í™”
    function toggleDiscountType(type) {
        const input = document.getElementById('add_discount');
        input.value = '';
        document.getElementById('unit_add_discount').innerText = '';
        
        if (type === 'rate') {
            input.placeholder = "ì˜ˆ: 30"; // 30%
        } else {
            input.placeholder = "ì˜ˆ: 5,000"; // 5000ì›
        }
    }

    function convertToKoreanNumber(num) {
        let number = parseInt(num, 10);
        if (isNaN(number) || number === 0) return '';
        let result = '';
        let tenThousand = Math.floor(number / 10000);
        let rest = number % 10000;

        if (tenThousand > 0) {
            let hundredMillion = Math.floor(tenThousand / 10000);
            let restTenThousand = tenThousand % 10000;
            if (hundredMillion > 0) result += hundredMillion + 'ì–µ ';
            if (restTenThousand > 0) result += restTenThousand + 'ë§Œ ';
            else if (hundredMillion === 0) result += tenThousand + 'ë§Œ ';
        }
        if (rest > 0) result += rest;
        return result + 'ì›';
    }

    function prepareSubmit() {
        const inputs = document.querySelectorAll('input[type="text"][onkeyup]');
        inputs.forEach(input => { input.value = input.value.replace(/,/g, ''); });
        return true;
    }

    function updatePrice() {
        const select = document.getElementById("phone_select");
        const priceInput = document.getElementById("device_price");
        if (select && priceInput) {
            const selectedOption = select.options[select.selectedIndex];
            const price = selectedOption.dataset.price; 
            if (price) {
                priceInput.value = price;
                formatNumber(priceInput);
            }
        }
    }

    function checkSubsidyStatus() {
        const checkedRadio = document.querySelector('input[name="carrier_type"]:checked');
        const subsidyInput = document.getElementById("subsidy_input");
        const subsidyUnit = document.getElementById("unit_subsidy_input");
        
        if (checkedRadio && subsidyInput) {
            if (checkedRadio.value === 'seonyak') {
                subsidyInput.disabled = true;
                subsidyInput.value = '';
                subsidyInput.style.backgroundColor = '#e9ecef';
                subsidyInput.placeholder = "ì§€ì›ê¸ˆ ì—†ìŒ";
                if(subsidyUnit) subsidyUnit.innerText = '';
            } else {
                subsidyInput.disabled = false;
                subsidyInput.style.backgroundColor = 'white';
                subsidyInput.placeholder = "500,000";
            }
        }
    }

    window.addEventListener('DOMContentLoaded', function() {
        // [New] í• ì¸ ì…ë ¥ì°½ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì´ˆê¸°í™”
        const inputs = document.querySelectorAll('input[type="text"]:not(#add_discount)');
        inputs.forEach(input => formatNumber(input));

        // [New] í• ì¸ ì…ë ¥ì°½ ë³„ë„ ì´ˆê¸°í™” (ê¸°ì¡´ ì…ë ¥ê°’ ìœ ì§€)
        const discountInput = document.getElementById('add_discount');
        if(discountInput) formatDiscountInput(discountInput);
        
        {% if not result %} updatePrice(); {% endif %}
        checkSubsidyStatus();
    });
</script>
{% endblock %}