{% extends "base.html" %}

{% block title %}ë¶€ë™ì‚° ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸°{% endblock %}

{% block content %}
    <h2>ğŸ  ë¶€ë™ì‚° ì¤‘ê°œë³´ìˆ˜ ê³„ì‚°ê¸°</h2>
    <p>ë§¤ë¬¼ ì¢…ë¥˜ì™€ ê±°ë˜ ê¸ˆì•¡(ë§Œì› ë‹¨ìœ„)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
        <form action="/real-estate/calc" method="post">
            
            <span class="form-label">ê±°ë˜ ì¢…ë¥˜</span>
            <div class="tab-container">
                <input type="radio" id="type_sale" name="transaction_type" value="sale" class="tab-radio" checked>
                <label for="type_sale" class="tab-label">ë§¤ë§¤ê³„ì•½</label>

                <input type="radio" id="type_jeonse" name="transaction_type" value="jeonse" class="tab-radio">
                <label for="type_jeonse" class="tab-label">ì „ì„¸ê³„ì•½</label>

                <input type="radio" id="type_monthly" name="transaction_type" value="monthly" class="tab-radio">
                <label for="type_monthly" class="tab-label">ì›”ì„¸ê³„ì•½</label>
            </div>

            <span class="form-label">ë§¤ë¬¼ ì¢…ë¥˜</span>
            <div class="tab-container">
                <input type="radio" id="build_house" name="building_type" value="house" class="tab-radio" checked>
                <label for="build_house" class="tab-label">ì£¼íƒ</label>

                <input type="radio" id="build_offi" name="building_type" value="officetel" class="tab-radio">
                <label for="build_offi" class="tab-label">ì˜¤í”¼ìŠ¤í…”</label>
            </div>

            <div style="margin-top: 20px;">
                <span class="form-label">ê±°ë˜ ê¸ˆì•¡ (ë³´ì¦ê¸ˆ)</span>
                <div class="input-group">
                    <input type="number" id="price_input" name="price_unit" placeholder="ì˜ˆ: 50000 (5ì–µì›ì¸ ê²½ìš°)" required onkeyup="convertMoney(this, 'price-preview', 10000)">
                    <span class="input-unit">ë§Œì›</span>
                </div>
                <div id="price-preview" class="korean-preview">0ì›</div>
            </div>

            <button type="submit" style="width: 100%; margin-top: 10px;">ì¤‘ê°œë³´ìˆ˜ ê³„ì‚°í•˜ê¸°</button>
        </form>
    </div>

    {% if result %}
        <div class="result-box">
            <h3>ğŸ“Š ê³„ì‚° ê²°ê³¼</h3>
            <p>ê±°ë˜ ì¢…ë¥˜: <strong>{{ trans_kor }}</strong> / ê±´ë¬¼: <strong>{{ build_kor }}</strong></p>
            <p>ê±°ë˜ ê¸ˆì•¡: <strong>{{ "{:,}".format(price) }}ì›</strong></p>
            <p>ì ìš© ìš”ìœ¨: <strong>{{ rate }}%</strong> 
                {% if max_fee > 0 %}(í•œë„ì•¡: {{ "{:,}".format(max_fee) }}ì›){% endif %}
            </p>
            <hr>
            <p>ì¤‘ê°œ ë³´ìˆ˜: {{ "{:,}".format(fee) }}ì›</p>
            <p>ë¶€ê°€ì„¸(10%): {{ "{:,}".format(vat) }}ì›</p>
            <p style="font-size: 1.2rem; color: blue;">
                <strong>ì´ ì˜ˆìƒ ê¸ˆì•¡: {{ "{:,}".format(total) }}ì›</strong>
            </p>
        </div>
    {% endif %}

    <script>
        function convertMoney(input, targetId, unitMultiplier) {
            const val = input.value;
            const target = document.getElementById(targetId);
            
            if (!val || val == 0) {
                target.innerText = "0ì›";
                return;
            }

            // ë§Œì› ë‹¨ìœ„ ì…ë ¥ì´ë©´ * 10000 í•´ì„œ ì‹¤ì œ ì›ë‹¨ìœ„ë¡œ ë³€í™˜
            const numberVal = parseInt(val) * unitMultiplier;
            
            // í•œê¸€ ë³€í™˜ ë¡œì§
            const unitWords = ['', 'ë§Œ', 'ì–µ', 'ì¡°', 'ê²½'];
            let result = '';
            let num = numberVal;
            let count = 0;

            while (num > 0) {
                let mod = num % 10000;
                if (mod > 0) {
                    // 1234 -> 1ì²œ 2ë°± 3ì‹­ 4 (ì—¬ê¸°ì„  ê°„ë‹¨íˆ ìˆ«ì+ë‹¨ìœ„ë¡œ í‘œí˜„: 1234ë§Œ)
                    result = formatNumber(mod) + unitWords[count] + ' ' + result;
                }
                num = Math.floor(num / 10000);
                count++;
            }

            target.innerText = result + "ì›";
        }

        // 3ìë¦¬ ì½¤ë§ˆ ì°ê¸° í•¨ìˆ˜
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
    </script>
{% endblock %}