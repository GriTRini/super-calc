{% extends "base.html" %}

{% block title %}2025 퇴직금 계산기{% endblock %}

{% block content %}
    <h2>💰 퇴직금 계산기</h2>
    <p>입사일과 퇴사일, 최근 3개월 월급을 기준으로 예상 퇴직금을 계산합니다.</p>
    
    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
        
        <form action="/severance/calc" method="post">
            
            <h4 style="margin-bottom: 15px; color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px;">📅 근무 기간</h4>
            <div class="input-grid">
                <div>
                    <span class="form-label">입사일</span>
                    <input type="date" name="start_date" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;" value="{{ start_date }}">
                </div>
                <div>
                    <span class="form-label">퇴사일 (마지막 근무일)</span>
                    <input type="date" name="end_date" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;" value="{{ end_date }}">
                </div>
            </div>

            <h4 style="margin-top: 30px; margin-bottom: 15px; color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px;">💵 급여 정보 (세전)</h4>
            
            <div style="margin-bottom: 5px;">
                <span class="form-label">최근 3개월 월 기본급 (평균)</span>
                <input type="number" name="monthly_salary" placeholder="예: 3000000" required 
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;"
                       onkeyup="convertMoney(this, 'salary-preview', 1)" value="{{ monthly_salary }}">
            </div>
            <div id="salary-preview" class="korean-preview">0원</div>
            
            <p style="font-size: 0.85rem; color: #888; margin-bottom: 20px;">
                * 최근 3개월간 급여가 동일하다고 가정하고 계산합니다.
            </p>

            <h4 style="margin-top: 30px; margin-bottom: 15px; color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px;">➕ 추가 수당 (선택 입력)</h4>
            <div class="input-grid">
                <div>
                    <span class="form-label">연간 상여금 총액</span>
                    <input type="number" name="annual_bonus" value="{{ annual_bonus|default(0) }}" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div>
                    <span class="form-label">연차 수당</span>
                    <input type="number" name="annual_leave" value="{{ annual_leave|default(0) }}" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
            </div>

            <button type="submit" class="btn-yellow" style="margin-top: 30px; background-color: #4a6fa5; color: white;">퇴직금 계산하기</button>
        </form>
    </div>

    {% if result %}
        <div class="result-box" style="margin-top: 30px; background: #fff; border: 2px solid #4a6fa5; border-radius: 15px; overflow: hidden;">
            <div style="background-color: #4a6fa5; color: white; padding: 25px; text-align: center;">
                <p style="margin: 0; font-size: 0.95rem; opacity: 0.9;">예상 퇴직금 (세전)</p>
                <h2 style="margin: 5px 0 0 0; font-size: 2.2rem; color: #fff;">{{ "{:,}".format(severance_pay) }}원</h2>
            </div>
            
            <div style="padding: 25px;">
                {% if not is_eligible %}
                <div style="background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; text-align: center; margin-bottom: 15px;">
                    ⚠️ 재직 기간이 1년 미만인 경우, 법적으로 퇴직금 지급 의무가 없습니다.
                </div>
                {% endif %}

                <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1rem;">
                    <span style="color: #666;">총 재직 일수</span>
                    <strong>{{ "{:,}".format(service_days) }}일</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1rem;">
                    <span style="color: #666;">1일 평균 임금</span>
                    <strong>{{ "{:,}".format(avg_daily_wage) }}원</strong>
                </div>

                <hr style="margin: 20px 0; border: 0; border-top: 2px dashed #eee;">
                
                <div style="font-size: 0.9rem; color: #888; line-height: 1.5;">
                    <p><strong>💡 계산 공식:</strong></p>
                    <p>1일 평균임금 × 30일 × (총 재직일수 ÷ 365)</p>
                    <p>* 실제 지급액은 회사의 퇴직연금 가입 여부(DB/DC) 및 사규에 따라 다를 수 있습니다.</p>
                </div>
            </div>
        </div>
    {% endif %}

    <script>
        function convertMoney(input, targetId, unitMultiplier) {
            const val = input.value;
            const target = document.getElementById(targetId);
            if (!val || val == 0) { target.innerText = "0원"; return; }
            const numberVal = parseInt(val) * unitMultiplier;
            const unitWords = ['', '만', '억', '조'];
            let result = '';
            let num = numberVal;
            let count = 0;
            while (num > 0) {
                let mod = num % 10000;
                if (mod > 0) {
                    result = formatNumber(mod) + unitWords[count] + ' ' + result;
                }
                num = Math.floor(num / 10000);
                count++;
            }
            target.innerText = result + "원";
        }
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
    </script>
{% endblock %}